<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover"
    />
    <title>Playbook (Zero-Dependency)</title>
    <style>
      :root {
        --bg: #0f0f12;
        --card: #15161a;
        --muted: #8b8d93;
        --text: #e9e9ee;
        --accent: #6ea8fe;
        --border: #24262c;
        --shadow: 0 8px 30px rgba(0,0,0,0.35);
      }
      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
        background: radial-gradient(1200px 800px at 80% -100px, #1b1e27, transparent), var(--bg);
        color: var(--text);
      }
      header {
        position: sticky; top: 0; z-index: 10;
        border-bottom: 1px solid var(--border);
        background: rgba(15,15,18,0.7);
        backdrop-filter: blur(8px);
      }
      .container { max-width: 1100px; margin: 0 auto; padding: 16px; }
      .title { font-size: 20px; font-weight: 700; }
      .row { display: flex; gap: 8px; align-items: center; }
      .btn {
        background: var(--card);
        color: var(--text);
        border: 1px solid var(--border);
        padding: 8px 12px;
        border-radius: 12px;
        cursor: pointer;
      }
      .btn.primary {
        background: var(--accent);
        color: #0b1220;
        border-color: transparent;
      }
      .grid { display: grid; gap: 14px; grid-template-columns: repeat(12, 1fr); }
      .col-12 { grid-column: span 12; }
      @media (min-width: 640px) {
        .col-sm-6 { grid-column: span 6; }
        .col-sm-4 { grid-column: span 4; }
      }
      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 20px;
        box-shadow: var(--shadow);
      }
      .card .body { padding: 16px; }
      .card .header {
        padding: 16px;
        border-bottom: 1px solid var(--border);
        display: flex; align-items: center; justify-content: space-between;
      }
      .muted { color: var(--muted); font-size: 12px; }
      .plays-box { height: 420px; overflow: auto; }
      .play-card {
        background: #0f1116;
        border: 1px solid var(--border);
        border-radius: 16px;
      }
      .play-card .h {
        padding: 12px 14px; border-bottom: 1px solid var(--border);
        display: flex; justify-content: space-between; align-items: center;
      }
      .play-card .name { font-size: 14px; font-weight: 600; max-width: 16rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
      .play-card .meta { color: var(--muted); font-size: 11px; }
      .play-card .content { padding: 14px; }
      .preview {
        border: 2px dashed #2a2d36; height: 128px; border-radius: 12px;
        display: grid; place-items: center; color: var(--muted); font-size: 12px; margin-bottom: 10px;
      }
      textarea, input[type="text"] {
        width: 100%; padding: 12px 14px; border-radius: 12px;
        border: 1px solid var(--border); background: #0f1116; color: var(--text);
        outline: none;
      }
      textarea:focus, input[type="text"]:focus { border-color: #2b3342; }
      .kbd {
        border: 1px solid var(--border); border-radius: 6px; padding: 0 6px; font-size: 12px;
      }
      .empty {
        height: 100%; display: grid; place-items: center; color: var(--muted);
      }
      .actions { display: flex; gap: 8px; align-items: center; }
      .right { margin-left: auto; }
    </style>
  </head>
  <body>
    <header>
      <div class="container row">
        <div class="title">Playbook</div>
        <div class="row right">
          <button class="btn">Import</button>
          <button class="btn primary">New Play</button>
        </div>
      </div>
    </header>

    <div id="root"></div>

    <!-- React (ESM) -->
    <script type="module">
      import React, { useMemo, useRef, useState } from "https://esm.sh/react@18";
      import { createRoot } from "https://esm.sh/react-dom@18/client";

      function PlaybookHome() {
        const [plays, setPlays] = useState([]);
        const [callText, setCallText] = useState("");
        const inputRef = useRef(null);

        function addPlayFromCall() {
          const raw = callText.trim();
          if (!raw) return;
          const name = deriveName(raw);
          const id = (crypto && crypto.randomUUID) ? crypto.randomUUID() : String(Date.now());
          setPlays(p => [{ id, name, call: raw, createdAt: Date.now() }, ...p]);
          setCallText("");
          queueMicrotask(() => inputRef.current && inputRef.current.focus());
        }

        function deriveName(raw) {
          const tokens = raw.split(/\s+/).filter(Boolean);
          return tokens.length ? tokens.slice(0, 3).join(" ") : (raw.slice(0, 20) || "Untitled Play");
        }

        function removePlay(id) {
          setPlays(p => p.filter(x => x.id !== id));
        }

        const emptyState = useMemo(() => (
          <div className="empty">
            <div style="text-align:center">
              <div style="margin-bottom:8px">▶</div>
              <div>No plays yet</div>
              <div className="muted">Enter a play call below to add your first play.</div>
            </div>
          </div>
        ), []);

        return (
          <div className="container" style={{paddingTop: "18px", paddingBottom: "32px"}}>
            <div className="grid">
              {/* Plays Box */}
              <div className="col-12">
                <div className="card">
                  <div className="header">
                    <div style={{fontWeight:600}}>Plays</div>
                    <div className="muted">{plays.length} {plays.length === 1 ? "play" : "plays"}</div>
                  </div>
                  <div className="body plays-box">
                    {plays.length === 0 ? (
                      <div className="card" style="height:100%; border: 1px dashed #2a2d36; background:none;">
                        {emptyState}
                      </div>
                    ) : (
                      <div className="grid" style={{gridTemplateColumns:"repeat(12,1fr)"}}>
                        {plays.map(play => (
                          <div className="col-12 col-sm-6 col-sm-4" key={play.id}>
                            <div className="play-card">
                              <div className="h">
                                <div>
                                  <div className="name" title={play.name}>{play.name}</div>
                                  <div className="meta">{new Date(play.createdAt).toLocaleString()}</div>
                                </div>
                                <button className="btn" onClick={() => removePlay(play.id)} title="Delete">Delete</button>
                              </div>
                              <div className="content">
                                <div className="preview">Diagram preview</div>
                                <div style="font: 12px ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; color:#cbd3ff;">
                                  {play.call}
                                </div>
                              </div>
                            </div>
                          </div>
                        ))}
                      </div>
                    )}
                  </div>
                </div>
              </div>

              {/* Input Box */}
              <div className="col-12">
                <div className="card">
                  <div className="body">
                    <label for="play-call" style="display:block; font-weight:600; margin-bottom:8px;">Play call</label>
                    <textarea
                      id="play-call"
                      ref={inputRef}
                      value={callText}
                      onChange={e => setCallText(e.target.value)}
                      placeholder="e.g., Trips Right 2x2 — X Post, Y Go, Z In, RB Swing, TE 5yd Sit"
                      rows="4"
                      onKeyDown={e => {
                        if ((e.metaKey || e.ctrlKey) && e.key === "Enter") {
                          e.preventDefault();
                          addPlayFromCall();
                        }
                      }}
                    ></textarea>
                    <div style="margin-top:10px; display:flex; justify-content:space-between; align-items:center;">
                      <div className="muted">
                        Tip: Press <span class="kbd">Ctrl/⌘</span>+<span class="kbd">Enter</span> to add quickly
                      </div>
                      <div className="actions">
                        <button className="btn" onClick={() => setCallText("")}>Clear</button>
                        <button className="btn primary" onClick={addPlayFromCall}>Add to Plays</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        );
      }

      createRoot(document.getElementById("root")).render(<PlaybookHome />);
    </script>
  </body>
</html>
